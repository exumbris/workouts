<script type="text/javascript">
var AttributesManagerRow = React.createClass({
	getInitialState: function () {
		return ({edit:0,name:this.props.data.attribute_name,label:this.props.data.attribute_label,comments:this.props.data.comments});
	},
	componentDidUpdate: function () {
		var attrnum = this.props.data.attribute_num;
		$('#attribute-manager-row-'+this.props.data.id).draggable({
			containment:'parent',
			revert:true,
			start: function () {
				//console.log('start drag');
			},
			stop: function (e,ui) {
				var vd = ui.position.top/$(this).outerHeight();
				$.ajax({
					type:"POST",
					data:{query_type:"workout_management_attributes_reorder",attrnum:attrnum,vd:vd},
					url:"php/dbq.php",
					success: function (data) {
						console.log(data);
					},
					error: function (xhr,status,err) {
						console.error("AttributesManagerRow","workout_management_attributes_reorder",status,err.toString());
					}
				});
			}
		});
	},
	handleSetEdit: function () {
		this.setState({edit:(this.state.edit==0)?1:0});
	},
	handleChange: function (type,event) {
		if(this.state.edit==1){
			switch(type){
				case "name":
					this.setState({name:event.target.value});
					break;
				case "label":
					this.setState({label:event.target.value});
					break;
				case "comments":
					this.setState({comments:event.target.value});
					break;
				default:
					console.log('error');
					break;
			}
		}
	},
	handleAcceptChanges: function () {
		$.ajax({
			url:"php/dbq.php",
			type:"POST",
			data:{query_type:"workout_management_attribute_save",id:this.props.data.id,name:this.state.name,label:this.state.label,comments:this.state.comments},
			success: function (data) {
				console.log(data);
				this.setState({edit:0});
			}.bind(this),
			error: function (xhr,status,err) {
				console.error("AttributesManagerRow","workout_management_attribute_save",status,err.toString());
			}
		});
	},
	handleDelete: function () {
		var c = confirm("Are you sure you wish to delete this attribute [name=\""+this.state.name+"\"] ?");
		if(c==true){
			$.ajax({
				url:"php/dbq.php",
				type:"POST",
				data:{query_type:"workout_management_attribute_delete",id:this.props.data.id},
				success: function (data) {
					console.log(data);
					this.setState({edit:"deleted"});
				}.bind(this),
				error: function (xhr,status,err) {
					console.error("AttributesManagerRow","workout_management_attribute_delete",status,err.toString());
				}
			});
		}
	},
	render: function () {
		console.log(this.props);
		return React.createElement("span",{className:((this.state.edit==1)?"editable":(this.state.edit=="deleted")?"hidden":"")+" wm-attributes-manager-row",id:"attribute-manager-row-"+this.props.data.id},
			React.createElement("input",{type:"text",value:this.state.name,onChange:this.handleChange.bind(this,"name")}),
			React.createElement("i",{className:(this.state.edit==1)?"fa fa-check":"hidden",onClick:this.handleAcceptChanges}),
			React.createElement("i",{className:"fa fa-pencil",onClick:this.handleSetEdit}),
			React.createElement("i",{className:"fa fa-trash",onClick:this.handleDelete})
		);
	}
});
</script>